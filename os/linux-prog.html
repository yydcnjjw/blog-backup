<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-04-07 æ—¥ 22:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="yydcnjjw" />
<link rel="stylesheet" href="https://yydcnjjw.github.io/style/style.css" type="text/css">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org69de507">1. File I/O</a>
<ul>
<li><a href="#org03e8b18">1.1. File Descriptors</a></li>
<li><a href="#orgeb8040e">1.2. Opening Files</a>
<ul>
<li><a href="#org7a191cc">1.2.1. <code>open</code> and <code>openat</code> Functions</a></li>
</ul>
</li>
<li><a href="#org3cb835c">1.3. Reading</a></li>
<li><a href="#orga52a85f">1.4. Writing</a></li>
<li><a href="#org15f79cd">1.5. Synchronized I/O</a></li>
<li><a href="#orgded984d">1.6. Direct I/O</a></li>
<li><a href="#orgcf0ced0">1.7. Closing Files</a></li>
<li><a href="#orgf5e81ca">1.8. Seeking</a></li>
<li><a href="#org8a3239d">1.9. Positional Reads and Writes</a></li>
<li><a href="#org1613718">1.10. Truncating Files</a></li>
<li><a href="#org10d8e04">1.11. Multiplexed I/O</a></li>
</ul>
</li>
<li><a href="#org6296f33">2. Buffered I/O</a>
<ul>
<li><a href="#org0ee3c2a">2.1. Opening Files</a></li>
<li><a href="#org6736d35">2.2. Closing Streams</a></li>
<li><a href="#org72bcf77">2.3. Reading from a Stream</a></li>
<li><a href="#org4aea69c">2.4. Writing to a Stream</a></li>
<li><a href="#orgbc14c02">2.5. Seeking a Stream</a></li>
<li><a href="#orgadcb699">2.6. Flushing a Stream</a></li>
<li><a href="#org4bc6285">2.7. Errors and End-of-file</a></li>
<li><a href="#org3d3dc4d">2.8. Obtaining the Associated File Descriptor</a></li>
<li><a href="#org353ee0f">2.9. Controlling the Buffering</a></li>
<li><a href="#org12ac33c">2.10. Thread Safety</a>
<ul>
<li><a href="#org3f37f51">2.10.1. Manual File Locking</a></li>
<li><a href="#orga048db3">2.10.2. Unlocked Stream Operations</a></li>
</ul>
</li>
<li><a href="#org67eacaa">2.11. Critiques of Standard I/O</a></li>
</ul>
</li>
<li><a href="#org6f238d1">3. Advanced File I/O</a>
<ul>
<li><a href="#org65c836d">3.1. Scatter/gather I/O</a></li>
<li><a href="#orgee588fc">3.2. Event Poll</a>
<ul>
<li><a href="#org7f63e66">3.2.1. Creating a New Epoll Instance</a></li>
<li><a href="#orgae6bc43">3.2.2. Controlling Epoll</a></li>
<li><a href="#orgdfd725b">3.2.3. Waiting for Events with Epoll</a></li>
<li><a href="#org7dfcac2">3.2.4. <span class="todo TODO">TODO</span> Edge-Versus Level-Triggered Events</a></li>
</ul>
</li>
<li><a href="#org41a8a27">3.3. Mapping Files info Memory</a>
<ul>
<li><a href="#org497040a">3.3.1. Resizing a Mapping</a></li>
<li><a href="#org878abf0">3.3.2. Changing the Protection of a Mapping</a></li>
<li><a href="#orgb1119e9">3.3.3. Synchronizing a File with a Mapping</a></li>
<li><a href="#org4ecadfd">3.3.4. Giving Advice on a Mapping</a></li>
</ul>
</li>
<li><a href="#org0368159">3.4. Advice for Normal File I/O</a></li>
<li><a href="#org1a51ff7">3.5. Synchronized, nonsynchronized or Synchronous, Asynchronous Operations</a>
<ul>
<li><a href="#orgb3151df">3.5.1. Asynchronous I/O</a></li>
</ul>
</li>
<li><a href="#org3d50ffb">3.6. I/O Schedulers and I/O Performance</a>
<ul>
<li><a href="#org1f7719c">3.6.1. The Life of an I/O Scheduler</a></li>
<li><a href="#org2ad5d2c">3.6.2. Helping Out Reads</a></li>
<li><a href="#org368c235">3.6.3. Selecting and Configuring Your I/O Scheduler</a></li>
<li><a href="#org8261ba8">3.6.4. Optimizing I/O Performance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org32b050e">4. Process Management</a>
<ul>
<li><a href="#org7e07351">4.1. The Process ID</a>
<ul>
<li><a href="#org384c0c5">4.1.1. Process ID Allocation</a></li>
<li><a href="#org961079d">4.1.2. Obtaining the Process ID and Parent Process ID</a></li>
</ul>
</li>
<li><a href="#org14f23b7">4.2. Running a New Process</a>
<ul>
<li><a href="#orgb9aa8eb">4.2.1. The Exec Family of Calls</a></li>
<li><a href="#org6e79738">4.2.2. The fork() System Call</a></li>
</ul>
</li>
<li><a href="#orgfd49c48">4.3. Terminalting a Process</a></li>
<li><a href="#orgbd71c07">4.4. Waiting for Terminated Child Processes</a></li>
<li><a href="#org1b19e00">4.5. User and Groups</a></li>
<li><a href="#org9e64093">4.6. Session and Process Groups</a></li>
<li><a href="#orgdce9278">4.7. Daemons</a></li>
</ul>
</li>
<li><a href="#org8fd9971">5. Advanced Process Management</a>
<ul>
<li><a href="#orgd77a236">5.1. Yielding the Processor</a></li>
<li><a href="#orgff512bb">5.2. Process Priorities</a></li>
<li><a href="#orga957507">5.3. Processor Affinity</a></li>
<li><a href="#org5ac6fd5">5.4. Resource Limits</a></li>
</ul>
</li>
<li><a href="#org0664267">6. Threading</a>
<ul>
<li><a href="#org966b7f6">6.1. Pthread Mutexes</a></li>
</ul>
</li>
<li><a href="#org53a790a">7. File and Directory Management</a>
<ul>
<li><a href="#org3330d31">7.1. Files and Their Metadata</a>
<ul>
<li><a href="#orgdd097e7">7.1.1. The Stat Family</a></li>
<li><a href="#org53c1315">7.1.2. Permissions</a></li>
<li><a href="#orgf89e27b">7.1.3. Ownership</a></li>
<li><a href="#org574cf4a">7.1.4. Extended Attributes</a></li>
</ul>
</li>
<li><a href="#org43d9c96">7.2. Directories</a>
<ul>
<li><a href="#org75142de">7.2.1. current working directory</a></li>
<li><a href="#org55c5ae4">7.2.2. Creating Directories</a></li>
<li><a href="#orge6971d9">7.2.3. Removing Directories</a></li>
<li><a href="#org7787cb0">7.2.4. Reading a Directory' Contents</a></li>
</ul>
</li>
<li><a href="#orgaac6a15">7.3. Links</a></li>
<li><a href="#org027a2bd">7.4. Copying and Moving Files</a></li>
<li><a href="#orgef0568d">7.5. Device Nodes</a>
<ul>
<li><a href="#org10092f8">7.5.1. Special Device Nodes</a></li>
<li><a href="#org5a57542">7.5.2. The Random Number Generator</a></li>
</ul>
</li>
<li><a href="#orgfc57415">7.6. Out-of-Band communication</a></li>
<li><a href="#orgfdd5040">7.7. Monitoring File Events</a></li>
</ul>
</li>
<li><a href="#orgd849707">8. Memory Management</a>
<ul>
<li><a href="#orgb9a6c2f">8.1. allocating dynamic memory</a></li>
<li><a href="#org0ab987f">8.2. managing the data segment</a></li>
<li><a href="#org09b5f5d">8.3. Anonymous Memory Mappings</a></li>
<li><a href="#orge8dae57">8.4. Advanced Memory Allocation</a></li>
<li><a href="#org99908e6">8.5. Debugging Memory Allocations</a></li>
<li><a href="#org8869e93">8.6. Stack-Based Allocations</a></li>
<li><a href="#org2f44104">8.7. Choosing a Memory Allocation Mechanism</a></li>
<li><a href="#org4604956">8.8. Manipulating Memory</a></li>
<li><a href="#org45edbf0">8.9. Locking Memory</a></li>
</ul>
</li>
<li><a href="#org3c555ce">9. Signals</a>
<ul>
<li><a href="#org8eb50f9">9.1. Basic Signal Management</a>
<ul>
<li><a href="#orga1b121d">9.1.1. Signal Inherited</a></li>
<li><a href="#org8169822">9.1.2. Mappping Signal Numbers to Strings</a></li>
</ul>
</li>
<li><a href="#org8904ace">9.2. Sending a Signal</a></li>
<li><a href="#orge69da02">9.3. Reentrancy</a></li>
<li><a href="#orgcdc4482">9.4. Signal Sets</a></li>
<li><a href="#org11c95e5">9.5. Blocking Signals</a></li>
<li><a href="#orgb5725d4">9.6. Advanced Signal Managemet</a></li>
</ul>
</li>
<li><a href="#orgce50466">10. Time</a>
<ul>
<li><a href="#org835d7e7">10.1. time info</a></li>
<li><a href="#orgfa066d6">10.2. tuning the system clock</a></li>
<li><a href="#org052ca97">10.3. Sleeping and Waiting</a></li>
<li><a href="#org4668962">10.4. Timers</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="file:///home/yydcnjjw/resources/os/book/linux_program/linux_system_programming_2nd_edition.pdf">linux programming</a>
</p>

<div id="outline-container-org69de507" class="outline-2">
<h2 id="org69de507"><span class="section-number-2">1</span> File I/O</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org03e8b18" class="outline-3">
<h3 id="org03e8b18"><span class="section-number-3">1.1</span> File Descriptors</h3>
<div class="outline-text-3" id="text-1-1">
<p>
A file descriptor is a non-negative integer. When we want to read or write a file, we
identify the file with the file descriptor that was returned by <code>open</code> or <code>creat</code> as an
argument to either <code>read</code> or <code>write</code>.
</p>

<p>
By convention, UNIX System shells associate file descriptor:
</p>
<ul class="org-ul">
<li>0(<code>STDIN_FILENO</code>): the standard input of a process</li>
<li>1(<code>STDOUT_FILENO</code>): the standard output of a process</li>
<li>2(<code>STDERR_FILENO</code>): the standard error of a process</li>
</ul>

<p>
File descriptors range from 0 through <code>OPEN_MAX - 1</code>.
</p>
</div>
</div>
<div id="outline-container-orgeb8040e" class="outline-3">
<h3 id="orgeb8040e"><span class="section-number-3">1.2</span> Opening Files</h3>
<div class="outline-text-3" id="text-1-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=open(2)&section=all">open(2)</a>
</p>
</div>
<div id="outline-container-org7a191cc" class="outline-4">
<h4 id="org7a191cc"><span class="section-number-4">1.2.1</span> <code>open</code> and <code>openat</code> Functions</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
A file is opened or created by calling either the <code>open</code> function or the <code>openat</code> function.
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;fcntl.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;sys/types.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;sys/stat.h&gt;</span>

<span class="org-type">int</span> <span class="org-function-name">open</span>(<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">path</span>, <span class="org-type">int</span> <span class="org-variable-name">oflag</span>, ... <span class="org-comment-delimiter">/* </span><span class="org-comment">mode_t mode </span><span class="org-comment-delimiter">*/</span> );
<span class="org-type">int</span> <span class="org-function-name">openat</span>(<span class="org-type">int</span> <span class="org-variable-name">fd</span>, <span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">path</span>, <span class="org-type">int</span> <span class="org-variable-name">oflag</span>, ... <span class="org-comment-delimiter">/* </span><span class="org-comment">mode_t mode </span><span class="org-comment-delimiter">*/</span> );
<span class="org-comment-delimiter">// </span><span class="org-comment">Both return: file descriptor if OK, &#8722;1 on error</span>
</pre>
</div>

<ul class="org-ul">
<li><code>path</code>: the name of the file to open or create
<ul class="org-ul">
<li><code>open</code>: absolute pathname</li>
<li><code>openat</code>: relative pathname</li>
</ul></li>
<li><code>oflag</code>: determines the type of access used, the prefix name is O_* (e.g. <code>O_RDONLY, O_WRONLY_O_RDWR</code>)</li>
<li><code>mode_t</code>: provide the permissions of the newly created file</li>
<li><b>return</b>: the file descriptor returned by <code>open</code> and <code>openat</code> is guaranteed to be the lowest-numbered unused descriptor</li>
<li><code>fd</code>: is a file descriptor or <code>AT_FDCWD</code>
<ul class="org-ul">
<li>file descriptor: specifies the starting location in the file system where the relative pathname is to be evaluated. It is obtained by opening the directory where the relative pathname is to be evaluated.</li>
<li><code>AT_FDCWD</code>: current working directory</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org3cb835c" class="outline-3">
<h3 id="org3cb835c"><span class="section-number-3">1.3</span> Reading</h3>
<div class="outline-text-3" id="text-1-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=read(2)&section=all">read(2)</a>
</p>

<p>
size limits on <code>read</code>: According to POSIX.1, if count is greater than <code>SSIZE_MAX</code>, the result is implementation-defined
</p>
</div>
</div>

<div id="outline-container-orga52a85f" class="outline-3">
<h3 id="orga52a85f"><span class="section-number-3">1.4</span> Writing</h3>
<div class="outline-text-3" id="text-1-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=write(2)&section=all">write(2)</a>
When a user-space application issues a <code>write()</code> system call, the Linux kernel performs a few checks and the simply copies the dada into a buffer. Later, in the background, the kernel fathers up all of the dirty buffer, which are buffers that contain data newer than what is on disk, sorts them optimally and writes them out to dist(a process known as <b>writeback</b>)
</p>

<p>
delayed writes has the following problem
</p>
<ul class="org-ul">
<li>an application may believe that a write has occurred successfully, in the event of a system crash, the data will never make it to disk</li>
<li>the inability to enforce <b>write ordering</b></li>
<li>Any I/O error that occurs during writeback cannot be reported back to the process that issued the write request</li>
</ul>

<p>
To ensure that data is written out in a timely manner, the kernel institutes a <b>maximum buffer age</b> and write out all dirty buffers before they mature past the given value. Users can configure this value via <code>/proc/sys/vm/dirty_expire_centisecs</code> (one hundredths of a second)
</p>
</div>
</div>

<div id="outline-container-org15f79cd" class="outline-3">
<h3 id="org15f79cd"><span class="section-number-3">1.5</span> Synchronized I/O</h3>
<div class="outline-text-3" id="text-1-5">
<p>
<a id="orgcac2b5c"></a>
<a target="_blank" href="http://man.he.net/?topic=fsync(2)&section=all">fsync(2)</a>
<code>fdatasync</code> is similar to <code>fsync</code>, but does not flush modified metadata unless that metadata is needed in order to allow a subsequent data retrieval to be  correctly handled, <b>so <code>datasync</code> is an easy performance win</b>.
</p>

<p>
Neither function guarantees that any updated directory entries containing the file are synchronized to disk. To ensure that any updates to the directory entry are also committed to disk, <code>fsync</code> must also be called on a file descriptor opened against the file's directory.
</p>

<p>
<a target="_blank" href="http://man.he.net/?topic=sync(2)&section=all">sync(2)</a>
commit filesystem caches to disk
</p>

<p>
oflag:
</p>
<ul class="org-ul">
<li><code>O_SYNC</code>: an implicit <code>fsync</code>, but performance lower than <code>fsync</code></li>
<li><code>O_DSYNC</code>: an implicit <code>fdatasync</code>, but performance lower than <code>fdatasync</code></li>
<li><code>O_RSYNC</code>:</li>
</ul>
</div>
</div>

<div id="outline-container-orgded984d" class="outline-3">
<h3 id="orgded984d"><span class="section-number-3">1.6</span> Direct I/O</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Providing the <code>O_DIRECT</code> flag to <code>open()</code> instructs the kernel to minimize the presence of I/O management. When this flag is provided, I/O will initiate directly from user-space buffers to the device, bypassing the page cache. All I/O will be synchronous; operations will not return until completed.
</p>

<p>
When performing direct I/o, the request length, buffer alignment, and file offsets must all be integer multiples of the underlying device's sector size&#x2014;generally, this is 512 bytes. To remain compatible, applications should align to the larger logical block size.
</p>
</div>
</div>

<div id="outline-container-orgcf0ced0" class="outline-3">
<h3 id="orgcf0ced0"><span class="section-number-3">1.7</span> Closing Files</h3>
<div class="outline-text-3" id="text-1-7">
<p>
<a target="_blank" href="http://man.he.net/?topic=close(2)&section=all">close(2)</a>
After a program has finished working with a file descriptor, it can unmap the file descriptor from the associated file via the <code>close()</code> system call.
</p>

<p>
Note: Typically, filesystem do not flush buffers when a closed. If you need to be sure that the data is physically stored on the underlying disk, use <a href="#orgcac2b5c">1.5</a>
</p>
</div>
</div>

<div id="outline-container-orgf5e81ca" class="outline-3">
<h3 id="orgf5e81ca"><span class="section-number-3">1.8</span> Seeking</h3>
<div class="outline-text-3" id="text-1-8">
<p>
<a target="_blank" href="http://man.he.net/?topic=lseek(2)&section=all">lseek(2)</a>
</p>

<p>
Seeking past the end of a file dose nothing
</p>
<ul class="org-ul">
<li>read request: return <code>EOF</code></li>
<li>write request: new space will be created between the old length of the file and the new length, and it will be padded with zeros.
This zero padding is called a <b>hole</b>. On Unix-style filesystems, holes do not occupy any physical disk space. This implies that This implies that the total size of all files on a file system can add up to more than the physical size of the disk. Files with holes are called <b>spares files</b>. Sparse files can save considerable space and enhance performance because manipulating the holes dose not initiate any physical I/O.
A read request to the part of a file in a hole will return the appropriate number of zeros.</li>
</ul>
</div>
</div>

<div id="outline-container-org8a3239d" class="outline-3">
<h3 id="org8a3239d"><span class="section-number-3">1.9</span> Positional Reads and Writes</h3>
<div class="outline-text-3" id="text-1-9">
<p>
<a target="_blank" href="http://man.he.net/?topic=pread(2)&section=all">pread(2)</a>
</p>
<ul class="org-ul">
<li>these calls are easier to use</li>
<li>they do note update the file pointer upon completion</li>
<li>they avoid any potential races that might occur when using <code>lseek</code> (e.g., race conditions can be avoided )</li>
</ul>
</div>
</div>

<div id="outline-container-org1613718" class="outline-3">
<h3 id="org1613718"><span class="section-number-3">1.10</span> Truncating Files</h3>
<div class="outline-text-3" id="text-1-10">
<p>
<a target="_blank" href="http://man.he.net/?topic=truncate(2)&section=all">truncate(2)</a>
</p>
</div>
</div>

<div id="outline-container-org10d8e04" class="outline-3">
<h3 id="org10d8e04"><span class="section-number-3">1.11</span> Multiplexed I/O</h3>
<div class="outline-text-3" id="text-1-11">
<p>
<a target="_blank" href="http://man.he.net/?topic=select(2)&section=all">select(2)</a>
<a target="_blank" href="http://man.he.net/?topic=poll(2)&section=all">poll(2)</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org6296f33" class="outline-2">
<h2 id="org6296f33"><span class="section-number-2">2</span> Buffered I/O</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>block is an abstraction representing the smallest unit of storage on a filesystem. Inside the kernel, all filesystem operations occur in terms of blocks.</li>
<li><code>user-buffer I/O</code>: a way for applications to read and write data in whatever amounts fell natural but have the actual I/O occur in units of the filesystem block size.</li>
<li>block size: blocks are usually 512, 1024, 2048, 4096, or 8192 bytes in size.</li>
</ul>
</div>

<div id="outline-container-org0ee3c2a" class="outline-3">
<h3 id="org0ee3c2a"><span class="section-number-3">2.1</span> Opening Files</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=fopen(3)&section=all">fopen(3)</a>
</p>
</div>
</div>
<div id="outline-container-org6736d35" class="outline-3">
<h3 id="org6736d35"><span class="section-number-3">2.2</span> Closing Streams</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=fclose(3)&section=all">fclose(3)</a>
<a target="_blank" href="http://man.he.net/?topic=fcloseall(3)&section=all">fcloseall(3)</a>
</p>
</div>
</div>

<div id="outline-container-org72bcf77" class="outline-3">
<h3 id="org72bcf77"><span class="section-number-3">2.3</span> Reading from a Stream</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=fgetc(3)&section=all">fgetc(3)</a>
<a target="_blank" href="http://man.he.net/?topic=fread(3)&section=all">fread(3)</a>
</p>
</div>
</div>

<div id="outline-container-org4aea69c" class="outline-3">
<h3 id="org4aea69c"><span class="section-number-3">2.4</span> Writing to a Stream</h3>
<div class="outline-text-3" id="text-2-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=fputc(3)&section=all">fputc(3)</a>
<a target="_blank" href="http://man.he.net/?topic=fwrite(3)&section=all">fwrite(3)</a>
</p>
</div>
</div>

<div id="outline-container-orgbc14c02" class="outline-3">
<h3 id="orgbc14c02"><span class="section-number-3">2.5</span> Seeking a Stream</h3>
<div class="outline-text-3" id="text-2-5">
<p>
<a target="_blank" href="http://man.he.net/?topic=fseek(3)&section=all">fseek(3)</a>
</p>
</div>
</div>
<div id="outline-container-orgadcb699" class="outline-3">
<h3 id="orgadcb699"><span class="section-number-3">2.6</span> Flushing a Stream</h3>
<div class="outline-text-3" id="text-2-6">
<p>
<a target="_blank" href="http://man.he.net/?topic=fflush(3)&section=all">fflush(3)</a>
<code>fflush()</code> merely writes the user-buffered data out to the kernel buffer. The effect is the same as if user buffer was not employed and write() was used directly.
So, For writing user-buffered directly to the hard disk, you can call <code>fflush()</code>, followed immediately by <code>fsync()</code>.
</p>
</div>
</div>

<div id="outline-container-org4bc6285" class="outline-3">
<h3 id="org4bc6285"><span class="section-number-3">2.7</span> Errors and End-of-file</h3>
<div class="outline-text-3" id="text-2-7">
<p>
<a target="_blank" href="http://man.he.net/?topic=ferror(3)&section=all">ferror(3)</a>
</p>
</div>
</div>

<div id="outline-container-org3d3dc4d" class="outline-3">
<h3 id="org3d3dc4d"><span class="section-number-3">2.8</span> Obtaining the Associated File Descriptor</h3>
<div class="outline-text-3" id="text-2-8">
<p>
<a target="_blank" href="http://man.he.net/?topic=fileno(3)&section=all">fileno(3)</a>
</p>
</div>
</div>

<div id="outline-container-org353ee0f" class="outline-3">
<h3 id="org353ee0f"><span class="section-number-3">2.9</span> Controlling the Buffering</h3>
<div class="outline-text-3" id="text-2-9">
<p>
<a target="_blank" href="http://man.he.net/?topic=setbuf(3)&section=all">setbuf(3)</a>
Standard I/O implements three types of user buffering and provides developers with an interface for controlling the type and size of the buffer.
</p>
<ul class="org-ul">
<li>Unbuffered(<code>_IONBF</code>): No user buffering is performed.
Date is submitted directly to the kernel. As this disables user buffering, negating any benefit, this option is not commonly used, with a lone exception: standard error, by default, is unbuffered.</li>
<li>Line-buffered(<code>_IOLBF</code>):  Buffering is performed on a per-line basis.
<b>With each newline character, the buffer is submitted to the kernel</b>. Line buffering makes sense for streams being output to the screen, since messages printed to the screen are delimited with newlines.</li>
<li>Block-buffered(<code>_IOFBF</code>): Buffering is performed on a per-block basis, where a block is a fixed number of bytes.
By default, all streams associated with files are block-buffered. Standard I/o uses the term full buffering for block buffering.</li>
</ul>

<p>
Note:
<code>setvbuf</code>: 
</p>
<ul class="org-ul">
<li>must be called after opening the stream but before any other operations have been performed  on it.</li>
<li>The supplied buffer, if any, must exits when the stream is closed. A common mistake is to declare the buffer as an automatic variable in a scope that ends before the stream is closed.</li>
</ul>
</div>
</div>

<div id="outline-container-org12ac33c" class="outline-3">
<h3 id="org12ac33c"><span class="section-number-3">2.10</span> Thread Safety</h3>
<div class="outline-text-3" id="text-2-10">
<p>
The standard I/o functions are inherently thread-safe.
</p>
</div>

<div id="outline-container-org3f37f51" class="outline-4">
<h4 id="org3f37f51"><span class="section-number-4">2.10.1</span> Manual File Locking</h4>
<div class="outline-text-4" id="text-2-10-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=flockfile(3)&section=all">flockfile(3)</a>
</p>
</div>
</div>

<div id="outline-container-orga048db3" class="outline-4">
<h4 id="orga048db3"><span class="section-number-4">2.10.2</span> Unlocked Stream Operations</h4>
<div class="outline-text-4" id="text-2-10-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=unlocked_stdio(3)&section=all">unlocked_stdio(3)</a>
There is a second reason or performing manual locking on streams. With the finergrained and more precise control of locking that only the application programmer can provide, it might be possible to minimize the over head of locking and to improve performance.
</p>
</div>
</div>
</div>

<div id="outline-container-org67eacaa" class="outline-3">
<h3 id="org67eacaa"><span class="section-number-3">2.11</span> Critiques of Standard I/O</h3>
</div>
</div>
<div id="outline-container-org6f238d1" class="outline-2">
<h2 id="org6f238d1"><span class="section-number-2">3</span> Advanced File I/O</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org65c836d" class="outline-3">
<h3 id="org65c836d"><span class="section-number-3">3.1</span> Scatter/gather I/O</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Allows a single call to read from or write data to many buffers at once; useful for bunching together fields of different data structures to from one I/O transaction.
<a target="_blank" href="http://man.he.net/?topic=readv(2)&section=all">readv(2)</a>
</p>

<p>
optimizing the count:
During a vectored I/O operation, the Linux kernel must allocate internal data structures to represent each segment. <b>Normally, this allocation occurs dynamically</b>, based on the size of count. As an optimization, however, the Linux kernel creates a small array of segments on the stack that it uses if count is sufficiently small(Less than 8), negating the need to dynamically allocate the segments and thereby providing a small boost in performance.
</p>
</div>
</div>

<div id="outline-container-orgee588fc" class="outline-3">
<h3 id="orgee588fc"><span class="section-number-3">3.2</span> Event Poll</h3>
<div class="outline-text-3" id="text-3-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=epoll(7)&section=all">epoll(7)</a>
Both <code>poll()</code> and <code>select()</code> require the full list of file descriptors(fixed) to watch on each invocation. When this list grows large walking the list on each invocation becomes a scalability bottleneck.
Epoll circumvents this problem by decoupling the monitor registration from the actual monitoring.
</p>
</div>

<div id="outline-container-org7f63e66" class="outline-4">
<h4 id="org7f63e66"><span class="section-number-4">3.2.1</span> Creating a New Epoll Instance</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=epoll_create1(2)&section=all">epoll_create1(2)</a>
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-type">int</span> <span class="org-variable-name">epfd</span>;
epfd = epoll_create1(<span class="org-highlight-numbers-number">0</span>);
<span class="org-keyword">if</span> (epfd &lt; <span class="org-highlight-numbers-number">0</span>) {
  perror(<span class="org-string">"epoll_create1"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae6bc43" class="outline-4">
<h4 id="orgae6bc43"><span class="section-number-4">3.2.2</span> Controlling Epoll</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=epoll_ctl(2)&section=all">epoll_ctl(2)</a>
</p>
</div>
</div>

<div id="outline-container-orgdfd725b" class="outline-4">
<h4 id="orgdfd725b"><span class="section-number-4">3.2.3</span> Waiting for Events with Epoll</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=epoll_wait(2)&section=all">epoll_wait(2)</a>
</p>
</div>
</div>

<div id="outline-container-org7dfcac2" class="outline-4">
<h4 id="org7dfcac2"><span class="section-number-4">3.2.4</span> <span class="todo TODO">TODO</span> Edge-Versus Level-Triggered Events</h4>
</div>
</div>

<div id="outline-container-org41a8a27" class="outline-3">
<h3 id="org41a8a27"><span class="section-number-3">3.3</span> Mapping Files info Memory</h3>
<div class="outline-text-3" id="text-3-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=mmap(2)&section=all">mmap(2)</a>
The <code>mmap()</code> system call operates on pages. Both the addr and offset parameters must be aligned on a page-sized boundary.
</p>
</div>

<div id="outline-container-org497040a" class="outline-4">
<h4 id="org497040a"><span class="section-number-4">3.3.1</span> Resizing a Mapping</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=mremap(2)&section=all">mremap(2)</a>
</p>
</div>
</div>

<div id="outline-container-org878abf0" class="outline-4">
<h4 id="org878abf0"><span class="section-number-4">3.3.2</span> Changing the Protection of a Mapping</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=mprotect(2)&section=all">mprotect(2)</a>
</p>
</div>
</div>

<div id="outline-container-orgb1119e9" class="outline-4">
<h4 id="orgb1119e9"><span class="section-number-4">3.3.3</span> Synchronizing a File with a Mapping</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=msync(2)&section=all">msync(2)</a>
Without invocation of <code>msync()</code>, there is no guarantee that a dirty mapping will be written back to disk until the file is unmapped.
</p>
</div>
</div>

<div id="outline-container-org4ecadfd" class="outline-4">
<h4 id="org4ecadfd"><span class="section-number-4">3.3.4</span> Giving Advice on a Mapping</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=madvise(2)&section=all">madvise(2)</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org0368159" class="outline-3">
<h3 id="org0368159"><span class="section-number-3">3.4</span> Advice for Normal File I/O</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=posix_fadvise(2)&section=all">posix_fadvise(2)</a>
<a target="_blank" href="http://man.he.net/?topic=readahead(2)&section=all">readahead(2)</a>
</p>
</div>
</div>

<div id="outline-container-org1a51ff7" class="outline-3">
<h3 id="org1a51ff7"><span class="section-number-3">3.5</span> Synchronized, nonsynchronized or Synchronous, Asynchronous Operations</h3>
<div class="outline-text-3" id="text-3-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Synchronicity of write operations</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Synchronized</th>
<th scope="col" class="org-left">Nonsynchronized</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Synchronous</td>
<td class="org-left">Write operations do not return until the</td>
<td class="org-left">Write operations do not return until the data</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">data is flushed to disk. This is the behavior</td>
<td class="org-left">is stored in kernel buffers. This is the usual</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">if <code>O_SYNC</code> is specified during file open</td>
<td class="org-left">behavior</td>
</tr>

<tr>
<td class="org-left">Asynchronous</td>
<td class="org-left">Write operations return as soon as the request</td>
<td class="org-left">Write operations return as soon as the request</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">is queued. Once the write operation ultimately</td>
<td class="org-left">is queued. Once the write operation ultimately</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">executes, the data is guaranteed to be on disk</td>
<td class="org-left">executes, the data is guaranteed to at least</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">be stored in kernel buffers.</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> Synchronicity of read operations</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Synchronized</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Synchronous</td>
<td class="org-left">Read operations do not return until the data, which is up-to-date,</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">is stored in the provided buffer(this is the usual behavior).</td>
</tr>

<tr>
<td class="org-left">Asynchronous</td>
<td class="org-left">Read operations return as soon as the request is queued, but when the</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">read operation ultimately executes, the data returned is up-to-date</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgb3151df" class="outline-4">
<h4 id="orgb3151df"><span class="section-number-4">3.5.1</span> Asynchronous I/O</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=aio(7)&section=all">aio(7)</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org3d50ffb" class="outline-3">
<h3 id="org3d50ffb"><span class="section-number-3">3.6</span> I/O Schedulers and I/O Performance</h3>
<div class="outline-text-3" id="text-3-6">
</div>
<div id="outline-container-org1f7719c" class="outline-4">
<h4 id="org1f7719c"><span class="section-number-4">3.6.1</span> The Life of an I/O Scheduler</h4>
<div class="outline-text-4" id="text-3-6-1">
<p>
I/O schedulers perform two basic operations: merging and sorting.
</p>
<ul class="org-ul">
<li><code>Merging</code>: is the process of taking two or more adjacent I/O requests and combining them into a single request.</li>
<li><code>Sorting</code>: is the process of arranging pending I/O requests in ascending block order.</li>
</ul>
</div>
</div>

<div id="outline-container-org2ad5d2c" class="outline-4">
<h4 id="org2ad5d2c"><span class="section-number-4">3.6.2</span> Helping Out Reads</h4>
<div class="outline-text-4" id="text-3-6-2">
<ul class="org-ul">
<li><code>read latency</code> problem:</li>
<li><code>write-starving-reads</code> problem:</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="org31174df"></a>The Deadline I/O Scheduler<br /></li>

<li><a id="orge4c5402"></a>The Anticipatory I/O Scheduler<br /></li>
<li><a id="org42ba04e"></a>The CFQ I/O Scheduler<br /></li>
<li><a id="orgc9f1e27"></a>The Noop I/O Scheduler<br /></li>
</ol>
</div>
<div id="outline-container-org368c235" class="outline-4">
<h4 id="org368c235"><span class="section-number-4">3.6.3</span> Selecting and Configuring Your I/O Scheduler</h4>
</div>
<div id="outline-container-org8261ba8" class="outline-4">
<h4 id="org8261ba8"><span class="section-number-4">3.6.4</span> Optimizing I/O Performance</h4>
</div>
</div>
</div>
<div id="outline-container-org32b050e" class="outline-2">
<h2 id="org32b050e"><span class="section-number-2">4</span> Process Management</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org7e07351" class="outline-3">
<h3 id="org7e07351"><span class="section-number-3">4.1</span> The Process ID</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>The <code>idle process</code>: the kernel "runs" when there are no other runnable process, has the pid 0.</li>
<li>The <code>init process</code>: the kernel executes after booting the system, has the pid 1.</li>
</ul>

<p>
Unless the user explicitly tells the kernel what process to run(through the init kernel command-line parameter), the kernel has to identify a suitable init process on its own &#x2014; a rare example where the kernel dictates policy. The Linux kernel tries four executables, in the following order:
</p>
<ol class="org-ol">
<li><code>/sbin/init</code>: The preferred and most likely location for the init process.</li>
<li><code>/etc/init</code>: Another likely location for the init process.</li>
<li><code>/bin/init</code>: A fallback location for the init process.</li>
<li><code>/bin/sh</code>: The location of the Bourne shell, which the kernel tries to run if it fails to find an init process.</li>
</ol>

<p>
The first of these process that exists is executed as the init process. If all four processes fail to execute, the Linux kernel halts the system with a panic.
</p>
</div>

<div id="outline-container-org384c0c5" class="outline-4">
<h4 id="org384c0c5"><span class="section-number-4">4.1.1</span> Process ID Allocation</h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li>By default, the kernel imposes a maximum process ID value of 32768.</li>
<li>System administrators can set the value higher via <code>/proc/sys/kernel/pid_max</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-org961079d" class="outline-4">
<h4 id="org961079d"><span class="section-number-4">4.1.2</span> Obtaining the Process ID and Parent Process ID</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=getpid(2)&section=all">getpid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=getppid(2)&section=all">getppid(2)</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org14f23b7" class="outline-3">
<h3 id="org14f23b7"><span class="section-number-3">4.2</span> Running a New Process</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li><code>executing</code>: the act loads a binary program into memory, replacing the previous contents of the address space, and begins execution of the new program.</li>
<li><code>forking</code>: the act create a new process which initially is a near-duplicate of its parent process, and then an exec to load a new binary int o that process&#x2014;are thus required to execute a new program in a new process.</li>
</ul>
</div>

<div id="outline-container-orgb9aa8eb" class="outline-4">
<h4 id="orgb9aa8eb"><span class="section-number-4">4.2.1</span> The Exec Family of Calls</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=exec(3)&section=all">exec(3)</a>
A successful <code>execl()</code> call changes not only the address space and process image, but certain other attributes of the process:
</p>
<ul class="org-ul">
<li>Any pending signals are lost.</li>
<li>Any signals that the process is catching are returned to their default behavior, as the signal handlers no longer exist in the process's address space.</li>
<li>Any memory locks are dropped.</li>
<li>Most thread attributes are returned to the default values.</li>
<li>Most process statistics are reset.</li>
<li>Anything related to the process's memory address spaces, including any mapped files, is cleared.</li>
<li>Anything that exists solely in user spaces, including feature of the C library, such as <code>atexit()</code> behavior, is cleared.</li>
</ul>
</div>
</div>

<div id="outline-container-org6e79738" class="outline-4">
<h4 id="org6e79738"><span class="section-number-4">4.2.2</span> The fork() System Call</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
The child and the parent process are identical in nearly every facet, except for a few necessary differences:
</p>
<ul class="org-ul">
<li>The pid of the child is, of course, newly allocated and different from that of the parent.</li>
<li>The child's parent pid is set to the pid of its parent process.</li>
<li>Resource statistics are reset to zero in the child.</li>
<li>Any pending signals are cleared and not inherited by the child.</li>
<li>Any acquired file locks are not inherited by the child.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgfd49c48" class="outline-3">
<h3 id="orgfd49c48"><span class="section-number-3">4.3</span> Terminalting a Process</h3>
<div class="outline-text-3" id="text-4-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=exit(2)&section=all">exit(2)</a>
Before terminating the process, the C library performs the following shutdown steps, in order:
</p>
<ol class="org-ol">
<li>Call any functions registered with <code>atexit()</code> or <code>on_exit()</code>, in the reverse order of their registration.</li>
<li>Flush all open standard I/O streams.</li>
<li>Remove any temporary files created with the <code>tmpfile()</code> function.</li>
</ol>
<p>
These steps finish all the work the process needs to do in user space, so <code>exit()</code> invokes the system call <code>_exit()</code> to let the kernel handle the rest of the termination process.
When a process exits, the kernel cleans up all of the resources that it created on the process's behalf that are no longer in use. The includes, but is not limited to, allocated memory, open files and System V semaphores. After cleanup, the kernel destroys the process and notifies the parent of its child's demise.
</p>

<p>
<a target="_blank" href="http://man.he.net/?topic=atexit(3)&section=all">atexit(3)</a> and <a target="_blank" href="http://man.he.net/?topic=on_exit(3)&section=all">on_exit(3)</a>: used to register functions to be invoked upon process termination
</p>
<ul class="org-ul">
<li>If a process invokes an exec function, the list of registered functions is cleared.</li>
<li>If a process terminates via a signal, the registered functions are not called.</li>
<li>support at least <code>ATEXIT_MAX</code> registered functions.</li>
</ul>
</div>
</div>

<div id="outline-container-orgbd71c07" class="outline-3">
<h3 id="orgbd71c07"><span class="section-number-3">4.4</span> Waiting for Terminated Child Processes</h3>
<div class="outline-text-3" id="text-4-4">
<p>
<code>zombie</code> state: when a child dies before its parent. Only a minimal skeleton of what was once the process&#x2014;some basic kernel data structures containing potentially useful data&#x2014;is retained. 
A process in this state waits for its parent to inquire about its status(a procedure known as waiting on the zombie process). Only after the parent obtains the information preserved about the terminated child does the process formally exit and cease to exist even as a zombie.
</p>

<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=wait(2)&section=all">wait(2)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=waitpid(2)&section=all">waitpid(2)</a>:waiting for a specific process</li>
<li><a target="_blank" href="http://man.he.net/?topic=waitid(2)&section=all">waitid(2)</a>: is used to wait for and obtain information about the status change(termination, stopping, continuing) of a child process.</li>
<li><a target="_blank" href="http://man.he.net/?topic=wait3(2)&section=all">wait3(2)</a>: wait for process to change state</li>
</ul>

<p>
<a target="_blank" href="http://man.he.net/?topic=system(3)&section=all">system(3)</a>: exec shell command
During execution of the command, <code>SIGCHLD</code> is blocked, and <code>SIGINT</code> and <code>SIGQUIT</code> are ignored. Ignoring <code>SIGINT</code> and <code>SIGQUIT</code> has several implications, particularly if <code>system()</code> is invoked inside a loop. If calling <code>system()</code> from within a loop, you should ensure that the program properly checks the exit status of the child
</p>
</div>
</div>

<div id="outline-container-org1b19e00" class="outline-3">
<h3 id="org1b19e00"><span class="section-number-3">4.5</span> User and Groups</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li><code>Real user ID</code>: is the uid of the user who originally ran the process. It is set to the real user ID of the process's parent, and does not change during an exec call.</li>
<li><code>effective user ID</code>: the user ID that the process is currently wielding. Permission verifications normally check against this value. <b>by executing a setuid(suid) binary, the process can change its effective user ID. To be exact, the effective user ID is set to the user ID of the owner of the program file.</b></li>
<li><code>saved user ID</code>: is the process's original effective user ID.</li>
</ul>
<p>
The effective user ID is the value that matters: it's the user Id that is checked in the course of validating a process's credentials.
The real user ID and saved user ID act as surrogates or potential user ID values that nonroot processes are allowed to switch to and from.
The real user ID is the effective user ID belonging to the user actually running the program, and the saved user ID is the effective user ID from before a suid binary caused a change during exec.
</p>

<ul class="org-ul">
<li>changing the real or saved user or group id
<a target="_blank" href="http://man.he.net/?topic=setuid(2)&section=all">setuid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setgid(2)&section=all">setgid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setreuid(2)&section=all">setreuid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setregid(2)&section=all">setregid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setresuid(2)&section=all">setresuid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setresuid(2)&section=all">setresuid(2)</a>
Nonroot processes should use <code>seteuid()</code> to change their effective user IDs. Root processes should use <code>setuid()</code> if they wish to change all three user IDs and <code>seteuid()</code> if they wish to temporarily change just the effective user ID.</li>
<li>obtaining the user and group ids
<a target="_blank" href="http://man.he.net/?topic=getuid(2)&section=all">getuid(2)</a>/<a target="_blank" href="http://man.he.net/?topic=geteuid(2)&section=all">geteuid(2)</a>
<a target="_blank" href="http://man.he.net/?topic=getgid(2)&section=all">getgid(2)</a>/<a target="_blank" href="http://man.he.net/?topic=getegid(2)&section=all">getegid(2)</a></li>
</ul>
</div>
</div>

<div id="outline-container-org9e64093" class="outline-3">
<h3 id="org9e64093"><span class="section-number-3">4.6</span> Session and Process Groups</h3>
<div class="outline-text-3" id="text-4-6">
<p>
<a target="_blank" href="http://man.he.net/?topic=setsid(2)&section=all">setsid(2)</a>: creates a new session, assuming that the process is not already a process group leader. The calling process is made the session leader and sole member of the new session, which has no controlling tty.
</p>
</div>
</div>

<div id="outline-container-orgdce9278" class="outline-3">
<h3 id="orgdce9278"><span class="section-number-3">4.7</span> Daemons</h3>
<div class="outline-text-3" id="text-4-7">
<p>
<a target="_blank" href="http://man.he.net/?topic=daemon(7)&section=all">daemon(7)</a>
<a target="_blank" href="http://man.he.net/?topic=daemon(3)&section=all">daemon(3)</a>
A daemon is a process that runs int the background, not connecting to any controlling terminal.
In general, a program performs the following steps to become a daemon:
</p>
<ol class="org-ol">
<li>Call <code>fork()</code>. This creates a new process, which will become the daemon.</li>
<li>In the parent, call <code>exit()</code>. This ensures that the original parent(the daemon's grandparent) is satisfied that its child terminated, that the daemon's parent is no longer running, and that the daemon is not a process group leader. This last point is a requirement for the successful completion of the next step.</li>
<li>Call <code>setsid()</code>, giving the daemon a new process group and session, both of which have it as leader. This also ensures that the process has no associated controlling terminal(as the process just created a new session and will not assign one).</li>
<li>Change the working directory to the root directory via <code>chdir()</code>. This is done because the inherited working directory can be anywhere on the filesystem. Daemons tend to run for the duration of the system's uptime, and you don't want to keep some random directory open and thus prevent an administrator from unmounting the filesystem containing that directory.</li>
<li>Close all file descriptors. You do not want tot inherit open file descriptors, and, unaware, hold them open.</li>
<li>Open file descriptors 0, 1, and 2 and redirect them to <code>/dev/null</code>.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org8fd9971" class="outline-2">
<h2 id="org8fd9971"><span class="section-number-2">5</span> Advanced Process Management</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgd77a236" class="outline-3">
<h3 id="orgd77a236"><span class="section-number-3">5.1</span> Yielding the Processor</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=sched_yield(2)&section=all">sched_yield(2)</a>
</p>
</div>
</div>
<div id="outline-container-orgff512bb" class="outline-3">
<h3 id="orgff512bb"><span class="section-number-3">5.2</span> Process Priorities</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=nice(2)&section=all">nice(2)</a>: Passing 0 for inc is an easy way to obtain the current nice value.</li>
<li><a target="_blank" href="http://man.he.net/?topic=getpriority(2)&section=all">getpriority(2)</a>/<a target="_blank" href="http://man.he.net/?topic=setpriority(2)&section=all">setpriority(2)</a>:</li>
<li><a target="_blank" href="http://man.he.net/?topic=ioprio_get(2)&section=all">ioprio_get(2)</a>/<a target="_blank" href="http://man.he.net/?topic=ioprio_set(2)&section=all">ioprio_set(2)</a>:</li>
</ul>
</div>
</div>

<div id="outline-container-orga957507" class="outline-3">
<h3 id="orga957507"><span class="section-number-3">5.3</span> Processor Affinity</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=sched_getaffinity(2)&section=all">sched_getaffinity(2)</a>
<a target="_blank" href="http://man.he.net/?topic=sched_setaffinity(2)&section=all">sched_setaffinity(2)</a>
</p>
</div>
</div>

<div id="outline-container-org5ac6fd5" class="outline-3">
<h3 id="org5ac6fd5"><span class="section-number-3">5.4</span> Resource Limits</h3>
<div class="outline-text-3" id="text-5-4">
<p>
<code>resource limits</code>: place hard ceilings on the amount of kernel resources that a process can consume&#x2014;that is, the number of open files, pages of memory, pending signals, and so on.
<a target="_blank" href="http://man.he.net/?topic=getrlimit(2)&section=all">getrlimit(2)</a>
<a target="_blank" href="http://man.he.net/?topic=setrlimit(2)&section=all">setrlimit(2)</a>
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> Default soft and hard resource limits</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">RLIMIT_AS</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_CORE</td>
<td class="org-left">0</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_CPU</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_DATA</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_FSIZE</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_LOCKS</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_MEMLOCK</td>
<td class="org-left">8 pages</td>
<td class="org-left">8 pages</td>
</tr>

<tr>
<td class="org-left">RLIMIT_MSGQUEUE</td>
<td class="org-left">800 KB</td>
<td class="org-left">800 KB</td>
</tr>

<tr>
<td class="org-left">RLIMIT_NICE</td>
<td class="org-left">0</td>
<td class="org-left">0</td>
</tr>

<tr>
<td class="org-left">RLIMIT_NOFILE</td>
<td class="org-left">1024</td>
<td class="org-left">1024</td>
</tr>

<tr>
<td class="org-left">RLIMIT_NPROC</td>
<td class="org-left">0 (implies no limit)</td>
<td class="org-left">0 (implies no limit)</td>
</tr>

<tr>
<td class="org-left">RLIMIT_RSS</td>
<td class="org-left">RLIM_INFINITY</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>

<tr>
<td class="org-left">RLIMIT_RTPRIO</td>
<td class="org-left">0</td>
<td class="org-left">0</td>
</tr>

<tr>
<td class="org-left">RLIMIT_SIGPENDING</td>
<td class="org-left">0</td>
<td class="org-left">0</td>
</tr>

<tr>
<td class="org-left">RLIMIT_STACK</td>
<td class="org-left">8 MB</td>
<td class="org-left">RLIM_INFINITY</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org0664267" class="outline-2">
<h2 id="org0664267"><span class="section-number-2">6</span> Threading</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=pthread_create(3)&section=all">pthread_create(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_self(3)&section=all">pthread_self(3)</a>: obtain TID(thread ID)</li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_equal(3)&section=all">pthread_equal(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_exit(3)&section=all">pthread_exit(3)</a>: terminating yourself</li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_cancel(3)&section=all">pthread_cancel(3)</a>: terminating others
return success is only demonstrative of successfully processing the cancellation request. The actual termination occurs asynchronously
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=pthread_setcancelstate(3)&section=all">pthread_setcancelstate(3)</a>/<a target="_blank" href="http://man.he.net/?topic=pthread_setcanceltype(3)&section=all">pthread_setcanceltype(3)</a>: set cancelability state and type</li>
</ul></li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_join(3)&section=all">pthread_join(3)</a>: Joining allows one thread to block while waiting for the termination of another.</li>
<li><a target="_blank" href="http://man.he.net/?topic=pthread_detach(3)&section=all">pthread_detach(3)</a>:</li>
</ul>
</div>

<div id="outline-container-org966b7f6" class="outline-3">
<h3 id="org966b7f6"><span class="section-number-3">6.1</span> Pthread Mutexes</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li><p>
initializing mutexes:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-type">pthread_mutex_t</span> <span class="org-variable-name">mutex</span> = PTHREAD_MUTEX_INITIALIZAER
</pre>
</div></li>
<li>locking mutexes: <a target="_blank" href="http://man.he.net/?topic=pthread_mutex_lock(3)&section=all">pthread_mutex_lock(3)</a></li>
<li>unlocking mutexes: <a target="_blank" href="http://man.he.net/?topic=pthread_mutex_unlock(3)&section=all">pthread_mutex_unlock(3)</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org53a790a" class="outline-2">
<h2 id="org53a790a"><span class="section-number-2">7</span> File and Directory Management</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org3330d31" class="outline-3">
<h3 id="org3330d31"><span class="section-number-3">7.1</span> Files and Their Metadata</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orgdd097e7" class="outline-4">
<h4 id="orgdd097e7"><span class="section-number-4">7.1.1</span> The Stat Family</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=stat(2)&section=all">stat(2)</a>
</p>
</div>
</div>
<div id="outline-container-org53c1315" class="outline-4">
<h4 id="org53c1315"><span class="section-number-4">7.1.2</span> Permissions</h4>
<div class="outline-text-4" id="text-7-1-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=chmod(2)&section=all">chmod(2)</a>
</p>
</div>
</div>
<div id="outline-container-orgf89e27b" class="outline-4">
<h4 id="orgf89e27b"><span class="section-number-4">7.1.3</span> Ownership</h4>
<div class="outline-text-4" id="text-7-1-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=chown(2)&section=all">chown(2)</a>
</p>
</div>
</div>
<div id="outline-container-org574cf4a" class="outline-4">
<h4 id="org574cf4a"><span class="section-number-4">7.1.4</span> Extended Attributes</h4>
<div class="outline-text-4" id="text-7-1-4">
</div>
<ol class="org-ol">
<li><a id="orgc91a655"></a>Extended Attributes Operations<br />
<div class="outline-text-5" id="text-7-1-4-1">
<p>
POSIX defines four operations that applications may perform on a given file's  extended attributes:
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=listxattr(2)&section=all">listxattr(2)</a>: Given a file, return a list of all of the file's assigned extended attribute keys.</li>
<li><a target="_blank" href="http://man.he.net/?topic=getxattr(2)&section=all">getxattr(2)</a>: Given a file and key, return the corresponding value.</li>
<li><a target="_blank" href="http://man.he.net/?topic=setxattr(2)&section=all">setxattr(2)</a>: Given a file and key, and a value, assign that value to the key.</li>
<li><a target="_blank" href="http://man.he.net/?topic=removexattr(2)&section=all">removexattr(2)</a>: Given a file and a key, remove that extended attribute from the file.</li>
</ul>
<p>
For each operation, POSIX provides three system calls:
</p>
<ul class="org-ul">
<li>A version that operates on a given pathname; if the path refers to a symbolic link, the target of the link is operated upon(the usual behavior)</li>
<li>A version that operates on a given pathname; if the path refers to a symbolic link, the link itself is operated upon(<b>the standard l variant of a system call</b>)</li>
<li>A version that operates on a file descriptor(<b>the standard f variant</b>)</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org43d9c96" class="outline-3">
<h3 id="org43d9c96"><span class="section-number-3">7.2</span> Directories</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org75142de" class="outline-4">
<h4 id="org75142de"><span class="section-number-4">7.2.1</span> current working directory</h4>
<div class="outline-text-4" id="text-7-2-1">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=getcwd(3)&section=all">getcwd(3)</a>: get current working directory</li>
<li><a target="_blank" href="http://man.he.net/?topic=chdir(2)&section=all">chdir(2)</a>: change working directory</li>
</ul>
<p>
technique: 
<code>getcwd()</code> is to save the current working directory so that the process can return to it later
It's better, to <code>open()</code> the current directory and the <code>fchdir()</code> to it later.
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-type">int</span> <span class="org-variable-name">swd_fd</span>;
swd_fd = open (<span class="org-string">"."</span>, O_RDONLY);
<span class="org-keyword">if</span> (swd_fd == &#8722;<span class="org-highlight-numbers-number">1</span>) {
  perror (<span class="org-string">"open"</span>);
  exit (EXIT_FAILURE);
}
<span class="org-comment-delimiter">/* </span><span class="org-comment">change to a different directory </span><span class="org-comment-delimiter">*/</span>
ret = chdir (some_other_dir);
<span class="org-keyword">if</span> (ret) {
  perror (<span class="org-string">"chdir"</span>);
  exit (EXIT_FAILURE);
}
<span class="org-comment-delimiter">/* </span><span class="org-comment">do some other work in the new directory... </span><span class="org-comment-delimiter">*/</span>
<span class="org-comment-delimiter">/* </span><span class="org-comment">return to the saved directory </span><span class="org-comment-delimiter">*/</span>
ret = fchdir (swd_fd);
<span class="org-keyword">if</span> (ret) {
  perror (<span class="org-string">"fchdir"</span>);
  exit (EXIT_FAILURE);
}
<span class="org-comment-delimiter">/* </span><span class="org-comment">close the directory's fd </span><span class="org-comment-delimiter">*/</span>
ret = close (swd_fd);
<span class="org-keyword">if</span> (ret) {
  perror (<span class="org-string">"close"</span>);
  exit (EXIT_FAILURE);
}

</pre>
</div>
</div>
</div>
<div id="outline-container-org55c5ae4" class="outline-4">
<h4 id="org55c5ae4"><span class="section-number-4">7.2.2</span> Creating Directories</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=mkdir(2)&section=all">mkdir(2)</a>
</p>
</div>
</div>
<div id="outline-container-orge6971d9" class="outline-4">
<h4 id="orge6971d9"><span class="section-number-4">7.2.3</span> Removing Directories</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=rmdir(2)&section=all">rmdir(2)</a>
</p>
</div>
</div>
<div id="outline-container-org7787cb0" class="outline-4">
<h4 id="org7787cb0"><span class="section-number-4">7.2.4</span> Reading a Directory' Contents</h4>
<div class="outline-text-4" id="text-7-2-4">
<ol class="org-ol">
<li><a target="_blank" href="http://man.he.net/?topic=opendir(3)&section=all">opendir(3)</a>: create a directory steam
<a target="_blank" href="http://man.he.net/?topic=dirfd(3)&section=all">dirfd(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=readdir(3)&section=all">readdir(3)</a>: return the next entry in the directory represented by dir</li>
<li><a target="_blank" href="http://man.he.net/?topic=closedir(3)&section=all">closedir(3)</a>: close the directory stream represented by dir</li>
</ol>
<p>
<a target="_blank" href="http://man.he.net/?topic=readdir(2)&section=all">readdir(2)</a>/<a target="_blank" href="http://man.he.net/?topic=getdents(2)&section=all">getdents(2)</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgaac6a15" class="outline-3">
<h3 id="orgaac6a15"><span class="section-number-3">7.3</span> Links</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=link(2)&section=all">link(2)</a>: hard link</li>
<li><a target="_blank" href="http://man.he.net/?topic=symlink(2)&section=all">symlink(2)</a>: symbolic link</li>
<li><a target="_blank" href="http://man.he.net/?topic=unlink(2)&section=all">unlink(2)</a></li>
</ul>
</div>
</div>
<div id="outline-container-org027a2bd" class="outline-3">
<h3 id="org027a2bd"><span class="section-number-3">7.4</span> Copying and Moving Files</h3>
<div class="outline-text-3" id="text-7-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=rename(2)&section=all">rename(2)</a>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Effects of moving to and from different types of files</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Source/Destination</td>
<td class="org-left">file</td>
<td class="org-left">directory</td>
<td class="org-left">link</td>
<td class="org-left">not exist</td>
</tr>

<tr>
<td class="org-left">file</td>
<td class="org-left">dest is overwritten</td>
<td class="org-left">Failure with EISDIR</td>
<td class="org-left">The file is renamed and</td>
<td class="org-left">The file is renamed</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">by the source</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">dest is overwritten</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">directory</td>
<td class="org-left">Failure with ENDTDIR</td>
<td class="org-left">source is renamed as the dest</td>
<td class="org-left">The dir is renamed, and</td>
<td class="org-left">The dir is renamed</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">if the dest is empty; failure</td>
<td class="org-left">the dest is overwritten</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">with ENOTEMPTY otherwise</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">link</td>
<td class="org-left">The link is renamed</td>
<td class="org-left">Failure with EISDIR</td>
<td class="org-left">The link is renamed and</td>
<td class="org-left">The link is renamed</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">and the dest is ove-</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">the dest is overwritten</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">rwritten</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">no  exist</td>
<td class="org-left">Failure with ENOENT</td>
<td class="org-left">Failure with ENOENT</td>
<td class="org-left">Failure with ENOENT</td>
<td class="org-left">Failure with ENOENT</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgef0568d" class="outline-3">
<h3 id="orgef0568d"><span class="section-number-3">7.5</span> Device Nodes</h3>
<div class="outline-text-3" id="text-7-5">
<p>
<code>Device nodes</code> are special files that allow applications to interface with device drivers.
Each device node is assigned two numerical values, called a <code>major number</code> and a <code>minor number</code>.
</p>
</div>

<div id="outline-container-org10092f8" class="outline-4">
<h4 id="org10092f8"><span class="section-number-4">7.5.1</span> Special Device Nodes</h4>
<div class="outline-text-4" id="text-7-5-1">
<ul class="org-ul">
<li><code>null device</code>: major number of 1 and a minor number of 3
It lives at <code>/dev/null</code>. The device file should be owned by root and be readable and writable by all users. The kernel silently discards all write requests to the device. All read requests to the file return end-of-file(EOF).</li>
<li><code>zero device</code>: major number of 1 and a minor number of 5
It lives at <code>/dev/zero</code>. Like the null device, the kernel silently discards writes to the zero device. Reading from the device returns an infinite stream of null bytes.</li>
<li><code>full device</code>: major number of 1 and a minor number of 7
It lives at <code>/dev/full</code>. As with the zero device, read requests return null characters(\0). Write requests, however, always trigger the <code>ENOSPC</code> error, signifying that the underlying device is full.</li>
</ul>
</div>
</div>

<div id="outline-container-org5a57542" class="outline-4">
<h4 id="org5a57542"><span class="section-number-4">7.5.2</span> The Random Number Generator</h4>
<div class="outline-text-4" id="text-7-5-2">
<ul class="org-ul">
<li><code>/dev/random</code>: major number of 1 and a minor number of 8</li>
<li><code>/dev/urandom</code>: major number of 1 and a minor number of 9</li>
</ul>
<p>
Reads from /dev/random return entropy from this pool. The results are suitable for
seeding random number generators, performing key generation, and other tasks that
require cryptographically strong entropy.
</p>
</div>
</div>
</div>

<div id="outline-container-orgfc57415" class="outline-3">
<h3 id="orgfc57415"><span class="section-number-3">7.6</span> Out-of-Band communication</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<a target="_blank" href="http://man.he.net/?topic=ioctl(2)&section=all">ioctl(2)</a>
</p>
</div>
</div>

<div id="outline-container-orgfdd5040" class="outline-3">
<h3 id="orgfdd5040"><span class="section-number-3">7.7</span> Monitoring File Events</h3>
<div class="outline-text-3" id="text-7-7">
<p>
Linux provides an interface, <code>inotify</code>, for monitoring files
<a target="_blank" href="http://man.he.net/?topic=inotify(7)&section=all">inotify(7)</a>
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=inotify_init(2)&section=all">inotify_init(2)</a>: initialize inotify and return a file descriptor representing the initialized instance</li>
<li><a target="_blank" href="http://man.he.net/?topic=inotify_add_watch(2)&section=all">inotify_add_watch(2)</a>: add a watch to an initialized inotify instance</li>
<li><a target="_blank" href="http://man.he.net/?topic=inotify_rm_watch(2)&section=all">inotify_rm_watch(2)</a>: remove an exitsting watch from an inotify instance</li>
<li><a target="_blank" href="http://man.he.net/?topic=close(2)&section=all">close(2)</a>: closing the inotify instance's file descriptor</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgd849707" class="outline-2">
<h2 id="orgd849707"><span class="section-number-2">8</span> Memory Management</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgb9a6c2f" class="outline-3">
<h3 id="orgb9a6c2f"><span class="section-number-3">8.1</span> allocating dynamic memory</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=malloc(3)&section=all">malloc(3)</a>: allocating dynamic memory</li>
<li><a target="_blank" href="http://man.he.net/?topic=calloc(3)&section=all">calloc(3)</a>: allocate arrays and zero out memory
Note: We can use <code>calloc</code> for defining an "allocate and zero" function</li>
<li><a target="_blank" href="http://man.he.net/?topic=realloc(3)&section=all">realloc(3)</a>: resizing existing allocations</li>
<li><a target="_blank" href="http://man.he.net/?topic=free(3)&section=all">free(3)</a>: frees the memory at <code>ptr</code></li>
<li><a target="_blank" href="http://man.he.net/?topic=posix_memalign(3)&section=all">posix_memalign(3)</a>: allocate aligned memory</li>
</ul>
</div>
</div>

<div id="outline-container-org0ab987f" class="outline-3">
<h3 id="org0ab987f"><span class="section-number-3">8.2</span> managing the data segment</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=brk(2)&section=all">brk(2)</a>: set the break point(the end of the data segment) to the address specified by end</li>
<li><a target="_blank" href="http://man.he.net/?topic=sbrk(2)&section=all">sbrk(2)</a>: increment the end of the data segment by <code>increment</code> bytes, which may be a positive or negative delta. Return the revised break point. Thus, an increment of 0 provides the current break point.</li>
</ul>
</div>
</div>

<div id="outline-container-org09b5f5d" class="outline-3">
<h3 id="org09b5f5d"><span class="section-number-3">8.3</span> Anonymous Memory Mappings</h3>
<div class="outline-text-3" id="text-8-3">
<p>
<a target="_blank" href="http://man.he.net/?topic=mmap(2)&section=all">mmap(2)</a>: creating anonymous memory mappings:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-type">void</span> *<span class="org-variable-name">p</span>;
p = mmap (<span class="org-constant">NULL</span>,                        <span class="org-comment-delimiter">/* </span><span class="org-comment">do not care where </span><span class="org-comment-delimiter">*/</span>
          <span class="org-highlight-numbers-number">512</span> * <span class="org-highlight-numbers-number">1024</span>,                  <span class="org-comment-delimiter">/* </span><span class="org-comment">512 KB </span><span class="org-comment-delimiter">*/</span>
          PROT_READ | PROT_WRITE,      <span class="org-comment-delimiter">/* </span><span class="org-comment">read/write </span><span class="org-comment-delimiter">*/</span>
          MAP_ANONYMOUS | MAP_PRIVATE, <span class="org-comment-delimiter">/* </span><span class="org-comment">anonymous, private </span><span class="org-comment-delimiter">*/</span>
          &#8722;<span class="org-highlight-numbers-number">1</span>,                          <span class="org-comment-delimiter">/* </span><span class="org-comment">fd (ignored) </span><span class="org-comment-delimiter">*/</span>
          <span class="org-highlight-numbers-number">0</span>);                          <span class="org-comment-delimiter">/* </span><span class="org-comment">offset (ignored) </span><span class="org-comment-delimiter">*/</span>

<span class="org-keyword">if</span> (p == MAP_FAILED)
  perror (<span class="org-string">"mmap"</span>);
<span class="org-keyword">else</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">'p' points at 512 KB of anonymous memory... </span><span class="org-comment-delimiter">*/</span>

</pre>
</div>
<p>
<a target="_blank" href="http://man.he.net/?topic=munmap(2)&section=all">munmap(2)</a>: free an anonymous mapping
</p>
</div>
</div>

<div id="outline-container-orge8dae57" class="outline-3">
<h3 id="orge8dae57"><span class="section-number-3">8.4</span> Advanced Memory Allocation</h3>
<div class="outline-text-3" id="text-8-4">
<p>
<a target="_blank" href="http://man.he.net/?topic=mallopt(3)&section=all">mallopt(3)</a>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Parameter</td>
<td class="org-left">Origin</td>
<td class="org-left">Default value</td>
<td class="org-left">Valid values</td>
<td class="org-left">Special values</td>
</tr>

<tr>
<td class="org-left">M_CHECK_ACTION</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">0</td>
<td class="org-left">0 â€“ 2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">M_GRAIN</td>
<td class="org-left">XPG standard</td>
<td class="org-left">Unsupported on Linux</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">M_KEEP</td>
<td class="org-left">XPG standard</td>
<td class="org-left">Unsupported on Linux</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">M_MMAP_MAX</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">64 * 1024</td>
<td class="org-left">&gt;= 0</td>
<td class="org-left">0 disables use of mmap()</td>
</tr>

<tr>
<td class="org-left">M_MMAP_THRESHOLD</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">128 * 1024</td>
<td class="org-left">&gt;= 0</td>
<td class="org-left">0 disables use of the heap</td>
</tr>

<tr>
<td class="org-left">M_MXFAST</td>
<td class="org-left">XPG standard</td>
<td class="org-left">64</td>
<td class="org-left">0 - 80</td>
<td class="org-left">0 disables fast bins</td>
</tr>

<tr>
<td class="org-left">M_NLBLKS</td>
<td class="org-left">XPG standard</td>
<td class="org-left">Unsupported on Linux</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">M_PERTURB</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">0</td>
<td class="org-left">0 or 1</td>
<td class="org-left">0 disables perturbation</td>
</tr>

<tr>
<td class="org-left">M_TOP_PAD</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">0</td>
<td class="org-left">&gt;= 0</td>
<td class="org-left">0 disables top padding</td>
</tr>

<tr>
<td class="org-left">M_TRIM_THRESHOLD</td>
<td class="org-left">Linux-specific</td>
<td class="org-left">128 * 1024</td>
<td class="org-left">&gt;= -1</td>
<td class="org-left">-1 disables trimming</td>
</tr>
</tbody>
</table>

<p>
<a target="_blank" href="http://man.he.net/?topic=malloc_usable_size(3)&section=all">malloc_usable_size(3)</a>
<a target="_blank" href="http://man.he.net/?topic=malloc_trim(3)&section=all">malloc_trim(3)</a>
</p>
</div>
</div>

<div id="outline-container-org99908e6" class="outline-3">
<h3 id="org99908e6"><span class="section-number-3">8.5</span> Debugging Memory Allocations</h3>
<div class="outline-text-3" id="text-8-5">
<p>
Programs can set the environment variable <code>MALLOC_CHECK_</code> to enable enhanced debugging in the memory subsystem.
<a target="_blank" href="http://man.he.net/?topic=mallinfo(3)&section=all">mallinfo(3)</a>: obtain memory allocation information
<a target="_blank" href="http://man.he.net/?topic=malloc_stats(3)&section=all">malloc_stats(3)</a>: print memory allocation statistics
</p>
</div>
</div>

<div id="outline-container-org8869e93" class="outline-3">
<h3 id="org8869e93"><span class="section-number-3">8.6</span> Stack-Based Allocations</h3>
<div class="outline-text-3" id="text-8-6">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=alloca(3)&section=all">alloca(3)</a>: allocate memory that is automatically freed</li>
<li><a target="_blank" href="http://man.he.net/?topic=strdupa(3)&section=all">strdupa(3)</a>: duplicate a string</li>
</ul>

<p>
Variable-Length Arrays(VLAs), which are arrays whose geometry is set at runtime, not at compile time
</p>
</div>
</div>

<div id="outline-container-org2f44104" class="outline-3">
<h3 id="org2f44104"><span class="section-number-3">8.7</span> Choosing a Memory Allocation Mechanism</h3>
<div class="outline-text-3" id="text-8-7">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> Approaches to memory allocation in Linux</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Allocation approach</th>
<th scope="col" class="org-left">Pros</th>
<th scope="col" class="org-left">Cons</th>
</tr>

<tr>
<th scope="col" class="org-left">malloc()</th>
<th scope="col" class="org-left">Easy,simple,common</th>
<th scope="col" class="org-left">Returned memory not necessarily zeroed</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">calloc()</td>
<td class="org-left">Makes allocating arrays, zeros</td>
<td class="org-left">Convoluted interface if not allocating</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">returned memory</td>
<td class="org-left">arrays</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">realloc()</td>
<td class="org-left">Resizes existing allocations</td>
<td class="org-left">Useful only for resizing existing allocations</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">brk() and sbrk()</td>
<td class="org-left">Provides intimate control over</td>
<td class="org-left">Much too low-level for most users</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">the heap</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Anonymous memory</td>
<td class="org-left">Easy to work with, sharable,</td>
<td class="org-left">Suboptimal for small allocations;</td>
</tr>

<tr>
<td class="org-left">mappings</td>
<td class="org-left">developer to adjust protection</td>
<td class="org-left">malloc() automatically uses anonymous</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">level and provide advice;</td>
<td class="org-left">memory mappings when optimal</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">optimal for large mapping</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">posix_memalign()</td>
<td class="org-left">Allocates memory aligned to any</td>
<td class="org-left">Relatively new and thus portability is</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">reasonable boundary</td>
<td class="org-left">questionable; overkill unless alignment</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">concerns are pressing</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">memalign() and</td>
<td class="org-left">More common on other Unix</td>
<td class="org-left">Note POSIX standard, offers less alignment</td>
</tr>

<tr>
<td class="org-left">valloc()</td>
<td class="org-left">systems than posix_memalign()</td>
<td class="org-left">control than posix_memalign()</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">alloca()</td>
<td class="org-left">Very fast allocation, no need to</td>
<td class="org-left">Unable to return error, no good for large</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">explicitly free memory; great</td>
<td class="org-left">allocations, broken on some Unix systems</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">for small allocations</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Variable-length</td>
<td class="org-left">Same as alloca(), but frees</td>
<td class="org-left">Useful only for arrays; alloca() freeing</td>
</tr>

<tr>
<td class="org-left">arrays</td>
<td class="org-left">memory when array falls out of</td>
<td class="org-left">behavior may be preferable in some</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">scope, not when function returns</td>
<td class="org-left">situations; less common on other Unix systems</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">than alloca()</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org4604956" class="outline-3">
<h3 id="org4604956"><span class="section-number-3">8.8</span> Manipulating Memory</h3>
<div class="outline-text-3" id="text-8-8">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=memset(3)&section=all">memset(3)</a>: fill memory with a constant byte</li>
<li><a target="_blank" href="http://man.he.net/?topic=memcmp(3)&section=all">memcmp(3)</a>: compare memory areas</li>
<li><a target="_blank" href="http://man.he.net/?topic=memmove(3)&section=all">memmove(3)</a>: copy memory area</li>
<li><a target="_blank" href="http://man.he.net/?topic=memchr(3)&section=all">memchr(3)</a>: scan memory for a character</li>
<li><a target="_blank" href="http://man.he.net/?topic=memmem(3)&section=all">memmem(3)</a>: locate a substring</li>
<li><a target="_blank" href="http://man.he.net/?topic=memfrob(3)&section=all">memfrob(3)</a>: encrypt a memory area</li>
</ul>
</div>
</div>

<div id="outline-container-org45edbf0" class="outline-3">
<h3 id="org45edbf0"><span class="section-number-3">8.9</span> Locking Memory</h3>
<div class="outline-text-3" id="text-8-9">
<p>
<a target="_blank" href="http://man.he.net/?topic=mlock(2)&section=all">mlock(2)</a>
<a target="_blank" href="http://man.he.net/?topic=mincore(2)&section=all">mincore(2)</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org3c555ce" class="outline-2">
<h2 id="org3c555ce"><span class="section-number-2">9</span> Signals</h2>
<div class="outline-text-2" id="text-9">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> Signals</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Signal</th>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">Default action</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGABRT</th>
<th scope="col" class="org-left">Sent by abort()</th>
<th scope="col" class="org-left">Terminate with core dump</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGALRM</th>
<th scope="col" class="org-left">Sent by alarm()</th>
<th scope="col" class="org-left">Terminate</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGBUS</th>
<th scope="col" class="org-left">Hardware or alignment error</th>
<th scope="col" class="org-left">Terminate with core dump</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGCHLD</th>
<th scope="col" class="org-left">Child has terminated</th>
<th scope="col" class="org-left">Ignored</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGCONT</th>
<th scope="col" class="org-left">Process has continued after being stopped</th>
<th scope="col" class="org-left">Ignored</th>
</tr>

<tr>
<th scope="col" class="org-left">SIGFPE</th>
<th scope="col" class="org-left">Arithmetic exception</th>
<th scope="col" class="org-left">Terminate with core dump</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">SIGHUP</td>
<td class="org-left">Process's controlling terminal was closed</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">(most frequently, the user logged out)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">SIGILL</td>
<td class="org-left">Process tried to execute an illegal instruction</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGINT</td>
<td class="org-left">User generated the interrupt character (Ctrl-C)</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGIO</td>
<td class="org-left">Asynchronous I/O event</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGKILL</td>
<td class="org-left">Uncatchable process termination</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGPIPE</td>
<td class="org-left">Process wrote to a pipe but there are no readers</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGPROF</td>
<td class="org-left">Profiling timer expired</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGPWR</td>
<td class="org-left">Power failure</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGQUIT</td>
<td class="org-left">User generated the quit character (Ctrl-\)</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGSEGV</td>
<td class="org-left">Memory access</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGSTKFLT</td>
<td class="org-left">Coprocessor stack fault</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGSTOP</td>
<td class="org-left">Suspends execution of the process</td>
<td class="org-left">Stop</td>
</tr>

<tr>
<td class="org-left">SIGSYS</td>
<td class="org-left">Process tried to execute an invalid system call</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGTERM</td>
<td class="org-left">Catchable process termination</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGTRAP</td>
<td class="org-left">Break point encountered</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGTSTP</td>
<td class="org-left">User generated the suspend character (Ctrl-Z)</td>
<td class="org-left">Stop</td>
</tr>

<tr>
<td class="org-left">SIGTTIN</td>
<td class="org-left">Background process read from controlling terminal</td>
<td class="org-left">Stop</td>
</tr>

<tr>
<td class="org-left">SIGTTOU</td>
<td class="org-left">Background process wrote to controlling terminal</td>
<td class="org-left">Stop</td>
</tr>

<tr>
<td class="org-left">SIGURG</td>
<td class="org-left">Urgent I/O pending</td>
<td class="org-left">Ignored</td>
</tr>

<tr>
<td class="org-left">SIGUSR1</td>
<td class="org-left">Process-defined signal</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">SIGUSR2</td>
<td class="org-left">Process-defined signal</td>
<td class="org-left">Terminate</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">SIGVTALRM</td>
<td class="org-left">Generated by setitimer() when called with</td>
<td class="org-left">Terminate</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">the ITIMER_VIRTUAL flag</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">SIGWINCH</td>
<td class="org-left">Size of controlling terminal window changed</td>
<td class="org-left">Ignored</td>
</tr>

<tr>
<td class="org-left">SIGXCPU</td>
<td class="org-left">Processor resource limits were exceeded</td>
<td class="org-left">Terminate with core dump</td>
</tr>

<tr>
<td class="org-left">SIGXFSZ</td>
<td class="org-left">File resource limits were exceeded</td>
<td class="org-left">Terminate with core dump</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-org8eb50f9" class="outline-3">
<h3 id="org8eb50f9"><span class="section-number-3">9.1</span> Basic Signal Management</h3>
<div class="outline-text-3" id="text-9-1">
<p>
<a target="_blank" href="http://man.he.net/?topic=signal(2)&section=all">signal(2)</a>
<code>sighandler_t signal(int signum, sighandler_t handler);</code>
handler parameter:
</p>
<ul class="org-ul">
<li><code>SIG_DFL</code>: the behavior of the signal given by <code>signum</code> to its default</li>
<li><code>SIG_IGN</code>: Ignore the signal given by <code>signum</code></li>
<li>the address of a programmer-defined function(a "signal handler")</li>
</ul>

<p>
<a target="_blank" href="http://man.he.net/?topic=pause(2)&section=all">pause(2)</a>: wait for signal
</p>
</div>

<div id="outline-container-orga1b121d" class="outline-4">
<h4 id="orga1b121d"><span class="section-number-4">9.1.1</span> Signal Inherited</h4>
<div class="outline-text-4" id="text-9-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 7:</span> Inherited signal behavior</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Signal behavior</td>
<td class="org-left">Across forks</td>
<td class="org-left">Across execs</td>
</tr>

<tr>
<td class="org-left">Ignored</td>
<td class="org-left">Inherited</td>
<td class="org-left">Inherited</td>
</tr>

<tr>
<td class="org-left">Default</td>
<td class="org-left">Inherited</td>
<td class="org-left">Inherited</td>
</tr>

<tr>
<td class="org-left">Handled</td>
<td class="org-left">Inherited</td>
<td class="org-left">Not inherited</td>
</tr>

<tr>
<td class="org-left">Pending signals</td>
<td class="org-left">Not inherited</td>
<td class="org-left">Inherited</td>
</tr>
</tbody>
</table>

<p>
This behavior on process execution has one notable use:
when the shell executes a process "in the background"(or when another background process executes another process), the newly executed process should ignore the interrupt and quit characters. Thus, before a shell executes a background process, it should set <code>SIGINT</code> and <code>SIGQUIT</code> to <code>SIG_IGN</code>. It is therefore common for programs that handle these signals to first check to make sure they are not ignored. For example:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-comment-delimiter">/* </span><span class="org-comment">handle SIGINT, but only if it isn't ignored </span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">if</span> (signal(SIGINT, SIG_IGN) != SIG_IGN) {
  <span class="org-keyword">if</span> (signal(SIGINT, sigint_handler) == SIG_ERR) {
    fprintf(stderr, <span class="org-string">"Failed to handle SIGINT!\n"</span>);
  }
}
<span class="org-comment-delimiter">/* </span><span class="org-comment">handle SIGQUIT, but only if it isn't ignored </span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">if</span> (signal(SIGQUIT, SIG_IGN) != SIG_IGN) {
  <span class="org-keyword">if</span> (signal(SIGQUIT, sigquit_handler) = SIG_ERR) {
    fprintf(stderr, <span class="org-string">"Failed to handle SIGQUIT!\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8169822" class="outline-4">
<h4 id="org8169822"><span class="section-number-4">9.1.2</span> Mappping Signal Numbers to Strings</h4>
<div class="outline-text-4" id="text-9-1-2">
<ul class="org-ul">
<li>retrieve the string from a statically defined list <code>sys_siglist[]</code></li>
<li><a target="_blank" href="http://man.he.net/?topic=psignal(3)&section=all">psignal(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=strsignal(3)&section=all">strsignal(3)</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org8904ace" class="outline-3">
<h3 id="org8904ace"><span class="section-number-3">9.2</span> Sending a Signal</h3>
<div class="outline-text-3" id="text-9-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=kill(2)&section=all">kill(2)</a>: send signal to a process
In order to send a signal to another process, the sending process needs proper permissions. A process with the <code>CAP_KILL</code> capability. Without this capability, the sending process's effective or real user ID must be equal to the real or saved user ID of the receiving process.
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=raise(3)&section=all">raise(3)</a>: send a signal to the caller</li>
<li><a target="_blank" href="http://man.he.net/?topic=killpg(3)&section=all">killpg(3)</a>: send signal to a process group</li>
</ul>
</div>
</div>

<div id="outline-container-orge69da02" class="outline-3">
<h3 id="orge69da02"><span class="section-number-3">9.3</span> Reentrancy</h3>
<div class="outline-text-3" id="text-9-3">
<p>
<code>reentrant function</code>: It must not manipulate static data, must manipulate only stack-allocated data or data provided to it by the caller, and must not invoke any nonreentrant function
</p>
</div>
</div>

<div id="outline-container-orgcdc4482" class="outline-3">
<h3 id="orgcdc4482"><span class="section-number-3">9.4</span> Signal Sets</h3>
<div class="outline-text-3" id="text-9-4">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=sigemptyset(3)&section=all">sigemptyset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigfillset(3)&section=all">sigfillset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigaddset(3)&section=all">sigaddset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigdelset(3)&section=all">sigdelset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigismember(3)&section=all">sigismember(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigisemptyset(3)&section=all">sigisemptyset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigorset(3)&section=all">sigorset(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=sigandset(3)&section=all">sigandset(3)</a></li>
</ul>
</div>
</div>

<div id="outline-container-org11c95e5" class="outline-3">
<h3 id="org11c95e5"><span class="section-number-3">9.5</span> Blocking Signals</h3>
<div class="outline-text-3" id="text-9-5">
<p>
<a target="_blank" href="http://man.he.net/?topic=sigprocmask(2)&section=all">sigprocmask(2)</a>
<a target="_blank" href="http://man.he.net/?topic=sigpending(2)&section=all">sigpending(2)</a>: retrieving pending signals
<a target="_blank" href="http://man.he.net/?topic=sigsuspend(2)&section=all">sigsuspend(2)</a>: waiting for a set of signals
</p>
</div>
</div>

<div id="outline-container-orgb5725d4" class="outline-3">
<h3 id="orgb5725d4"><span class="section-number-3">9.6</span> Advanced Signal Managemet</h3>
<div class="outline-text-3" id="text-9-6">
<p>
<a target="_blank" href="http://man.he.net/?topic=sigaction(2)&section=all">sigaction(2)</a>
<a target="_blank" href="http://man.he.net/?topic=sigqueue(2)&section=all">sigqueue(2)</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgce50466" class="outline-2">
<h2 id="orgce50466"><span class="section-number-2">10</span> Time</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org835d7e7" class="outline-3">
<h3 id="org835d7e7"><span class="section-number-3">10.1</span> time info</h3>
<div class="outline-text-3" id="text-10-1">
<p>
get time
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=clock_getres(2)&section=all">clock_getres(2)</a>: find the resolution(precision) of the specified clock(<code>clk_id</code>)</li>
<li><a target="_blank" href="http://man.he.net/?topic=time(2)&section=all">time(2)</a>: get time in seconds</li>
<li><a target="_blank" href="http://man.he.net/?topic=gettimeofday(2)&section=all">gettimeofday(2)</a>:</li>
<li><a target="_blank" href="http://man.he.net/?topic=clock_gettime(2)&section=all">clock_gettime(2)</a>: obtain the time of a specific time source</li>
<li><a target="_blank" href="http://man.he.net/?topic=times(2)&section=all">times(2)</a>: get process times</li>
</ul>

<p>
set time
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=stime(2)&section=all">stime(2)</a>: set time</li>
<li><a target="_blank" href="http://man.he.net/?topic=settimeofday(2)&section=all">settimeofday(2)</a>: set time with precision</li>
<li><a target="_blank" href="http://man.he.net/?topic=clock_settime(2)&section=all">clock_settime(2)</a>:</li>
</ul>

<p>
convert between broken-down time and <code>time_t</code>
</p>
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=asctime(3)&section=all">asctime(3)</a>: <code>tm</code> -&gt; ascii string</li>
<li><a target="_blank" href="http://man.he.net/?topic=mktime(3)&section=all">mktime(3)</a>: <code>tm</code> -&gt; time_t</li>
<li><a target="_blank" href="http://man.he.net/?topic=ctime(3)&section=all">ctime(3)</a>: <code>time_t</code> -&gt; ascii representation</li>
<li><a target="_blank" href="http://man.he.net/?topic=gmtime(3)&section=all">gmtime(3)</a>: <code>time_t</code> -&gt; <code>tm</code></li>
<li><a target="_blank" href="http://man.he.net/?topic=localtime(3)&section=all">localtime(3)</a>: <code>timep</code> -&gt; broken-down time representation</li>
</ul>

<p>
<a target="_blank" href="http://man.he.net/?topic=difftime(3)&section=all">difftime(3)</a>: calculate time difference
</p>
</div>
</div>

<div id="outline-container-orgfa066d6" class="outline-3">
<h3 id="orgfa066d6"><span class="section-number-3">10.2</span> tuning the system clock</h3>
<div class="outline-text-3" id="text-10-2">
<p>
<a target="_blank" href="http://man.he.net/?topic=adjtime(3)&section=all">adjtime(3)</a>: correct the time to synchronize the system clock
</p>
</div>
</div>

<div id="outline-container-org052ca97" class="outline-3">
<h3 id="org052ca97"><span class="section-number-3">10.3</span> Sleeping and Waiting</h3>
<div class="outline-text-3" id="text-10-3">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=sleep(3)&section=all">sleep(3)</a>: sleep for a specified number of seconds</li>
<li><a target="_blank" href="http://man.he.net/?topic=usleep(3)&section=all">usleep(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=nanosleep(3)&section=all">nanosleep(3)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=clock_nanosleep(2)&section=all">clock_nanosleep(2)</a></li>
<li><p>
<a target="_blank" href="http://man.he.net/?topic=select(2)&section=all">select(2)</a>: provide a portable way to sleep with subsecond resolution.
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">struct</span> <span class="org-type">timeval</span> <span class="org-variable-name">tv</span> = {
  .tv_sec = <span class="org-highlight-numbers-number">0</span>,
  .tv_usec = <span class="org-highlight-numbers-number">747</span>
};
select(<span class="org-highlight-numbers-number">0</span>, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span>, &amp;tv);
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org4668962" class="outline-3">
<h3 id="org4668962"><span class="section-number-3">10.4</span> Timers</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li><a target="_blank" href="http://man.he.net/?topic=alarm(2)&section=all">alarm(2)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=getitimer(2)&section=all">getitimer(2)</a></li>
<li><a target="_blank" href="http://man.he.net/?topic=timer_create(2)&section=all">timer_create(2)</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: yydcnjjw</p>
<p class="date">Created: 2019-04-07 æ—¥ 22:30</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
